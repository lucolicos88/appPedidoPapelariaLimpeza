# üìã VERS√ÉO 8.0 - MUDAN√áAS DETALHADAS

## üéØ VIS√ÉO GERAL

A vers√£o 8.0 reestrutura completamente o aplicativo com foco em:
- **Organiza√ß√£o por fun√ß√£o** - Separa√ß√£o clara entre solicita√ß√£o e gest√£o de pedidos
- **Permiss√µes refinadas** - Controle de acesso por tipo de usu√°rio
- **Upload de imagens** - Fotos de produtos
- **Relat√≥rios avan√ßados** - M√∫ltiplos relat√≥rios com insights
- **Corre√ß√µes de bugs** - Erros em Gerenciamento e Configura√ß√µes

---

## üìä ESTRUTURA DO MENU (ANTES vs DEPOIS)

### **ANTES (v7.0):**
1. üìä Dashboard
2. üõí Pedidos
3. üì¶ Produtos
4. üìä Estoque
5. üìà Gerenciamento
6. üìÑ Relat√≥rios
7. ‚öôÔ∏è Configura√ß√µes

### **DEPOIS (v8.0):**
1. üìä **Dashboard** - Apenas Gestor e Admin
2. ‚ûï **Solicita√ß√£o** - Todos os usu√°rios (nova aba)
3. üõí **Pedidos** - Todos (gest√£o + baixa de produtos)
4. üì¶ **Produtos** - Gestor e Admin (cadastro completo com fotos)
5. üìä **Estoque** - Gestor e Admin (apenas entrada)
6. üìã **Movimenta√ß√£o** - Gestor e Admin (era "Gerenciamento")
7. üìà **Relat√≥rios** - Gestor e Admin (m√∫ltiplos relat√≥rios)
8. ‚öôÔ∏è **Configura√ß√µes** - Apenas Admin

---

## üîê PERMISS√ïES POR ABA

| Aba | Admin | Gestor | Funcion√°rio |
|-----|-------|--------|-------------|
| **Dashboard** | ‚úÖ Sim | ‚úÖ Sim | ‚ùå N√£o |
| **Solicita√ß√£o** | ‚úÖ Sim | ‚úÖ Sim | ‚úÖ **Sim** |
| **Pedidos** | ‚úÖ Sim | ‚úÖ Sim | ‚úÖ **Sim (view only)** |
| **Produtos** | ‚úÖ Sim | ‚úÖ Sim | ‚ùå N√£o |
| **Estoque** | ‚úÖ Sim | ‚úÖ Sim | ‚ùå N√£o |
| **Movimenta√ß√£o** | ‚úÖ Sim | ‚úÖ Sim | ‚ùå N√£o |
| **Relat√≥rios** | ‚úÖ Sim | ‚úÖ Sim | ‚ùå N√£o |
| **Configura√ß√µes** | ‚úÖ Sim | ‚ùå N√£o | ‚ùå N√£o |

---

## üÜï NOVAS FUNCIONALIDADES

### **1. ABA "SOLICITA√á√ÉO" (NOVA)**

**Objetivo:** Simplificar processo de solicitar pedidos

**Recursos:**
- Formul√°rio simplificado de solicita√ß√£o
- Busca r√°pida de produtos por nome ou c√≥digo
- Preview dos produtos selecionados
- Envio direto para aprova√ß√£o
- Hist√≥rico de solicita√ß√µes do usu√°rio

**Diferen√ßa da aba "Pedidos":**
- **Solicita√ß√£o:** Apenas criar novos pedidos (simples, r√°pido)
- **Pedidos:** Ver todos os pedidos, editar, aprovar, dar baixa, cancelar (completo)

**HTML:**
```html
<section class="page-section" id="page-solicitacao">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">‚ûï Nova Solicita√ß√£o de Pedido</h2>
    </div>

    <form id="formSolicitacao">
      <!-- Seletor de Tipo -->
      <div class="form-group">
        <label class="form-label">Tipo de Pedido *</label>
        <select class="form-control" id="solicitacaoTipo" required>
          <option value="">Selecione...</option>
          <option value="Papelaria">Papelaria</option>
          <option value="Limpeza">Limpeza</option>
        </select>
      </div>

      <!-- Busca de Produtos -->
      <div class="form-group">
        <label class="form-label">Buscar Produto</label>
        <input type="text" class="form-control" id="buscaProduto"
               placeholder="Digite nome ou c√≥digo do produto...">
        <div id="resultadosBusca"></div>
      </div>

      <!-- Produtos Selecionados -->
      <div class="form-group">
        <label class="form-label">Produtos Selecionados</label>
        <div id="produtosSelecionados"></div>
      </div>

      <!-- Observa√ß√µes -->
      <div class="form-group">
        <label class="form-label">Observa√ß√µes</label>
        <textarea class="form-control" id="solicitacaoObs" rows="3"></textarea>
      </div>

      <button type="submit" class="btn btn-success">‚úÖ Enviar Solicita√ß√£o</button>
    </form>
  </div>

  <!-- Hist√≥rico de Minhas Solicita√ß√µes -->
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">üìú Minhas Solicita√ß√µes Recentes</h2>
    </div>
    <div id="minhasSolicitacoes"></div>
  </div>
</section>
```

---

### **2. ABA "PEDIDOS" - ATUALIZA√á√ÉO**

**Novas Funcionalidades:**
- **Baixa de Produtos** - Dar sa√≠da no estoque quando pedido for entregue
- **Status mais detalhado** - Separar "Em Compra" de "Aguardando Entrega"
- **Filtro por solicitante** - Ver pedidos de um usu√°rio espec√≠fico

**Nova A√ß√£o: "Dar Baixa"**

Aparece quando pedido est√° em status "Aguardando Entrega"

**Modal de Baixa:**
```html
<div class="modal" id="modalBaixaPedido">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">üì¶ Dar Baixa no Pedido</h3>
      <button class="modal-close" onclick="closeModal('modalBaixaPedido')">&times;</button>
    </div>

    <p>Confirma a baixa dos produtos deste pedido no estoque?</p>

    <div id="produtosBaixa">
      <!-- Lista de produtos que ter√£o sa√≠da -->
    </div>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button class="btn btn-success" onclick="confirmarBaixa()">
        ‚úÖ Confirmar Baixa
      </button>
      <button class="btn btn-secondary" onclick="closeModal('modalBaixaPedido')">
        ‚ùå Cancelar
      </button>
    </div>
  </div>
</div>
```

**Nova Fun√ß√£o JavaScript:**
```javascript
function darBaixaPedido(pedidoId) {
  // Buscar produtos do pedido
  google.script.run
    .withSuccessHandler(function(response) {
      if (response.success) {
        // Mostrar modal com produtos
        renderModalBaixa(response.pedido);
        openModal('modalBaixaPedido');
      }
    })
    .withFailureHandler(showError)
    .__getPedidoById(pedidoId);
}

function confirmarBaixa() {
  const pedidoId = document.getElementById('baixaPedidoId').value;

  showLoading();
  google.script.run
    .withSuccessHandler(function(response) {
      hideLoading();
      if (response.success) {
        showSuccess('Baixa realizada com sucesso!');
        closeModal('modalBaixaPedido');
        loadPedidos(); // Recarregar lista
      } else {
        showError('Erro ao dar baixa: ' + response.error);
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showError('Erro: ' + error.message);
    })
    .__darBaixaPedido(pedidoId);
}
```

---

### **3. ABA "PRODUTOS" - UPLOAD DE FOTOS**

**Nova Coluna no Banco:** `Imagem URL`

**Nova Funcionalidade:** Upload de imagem via Google Drive

**Modal Atualizado:**
```html
<div class="modal" id="modalNovoProduto">
  <div class="modal-content" style="max-width: 800px;">
    <div class="modal-header">
      <h3 class="modal-title">‚ûï Novo Produto</h3>
      <button class="modal-close" onclick="closeModal('modalNovoProduto')">&times;</button>
    </div>

    <form id="formNovoProduto" onsubmit="submitNovoProduto(event)">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">C√≥digo *</label>
          <input type="text" class="form-control" id="novoProdutoCodigo" required>
        </div>

        <div class="form-group">
          <label class="form-label">Nome *</label>
          <input type="text" class="form-control" id="novoProdutoNome" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Tipo *</label>
          <select class="form-control" id="novoProdutoTipo" required>
            <option value="">Selecione...</option>
            <option value="Papelaria">Papelaria</option>
            <option value="Limpeza">Limpeza</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Categoria</label>
          <input type="text" class="form-control" id="novoProdutoCategoria">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Unidade</label>
          <select class="form-control" id="novoProdutoUnidade">
            <option value="UN">Unidade</option>
            <option value="CX">Caixa</option>
            <option value="PCT">Pacote</option>
            <option value="KG">Quilograma</option>
            <option value="L">Litro</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Pre√ßo Unit√°rio (R$)</label>
          <input type="number" step="0.01" class="form-control" id="novoProdutoPreco">
        </div>
      </div>

      <!-- NOVO: Upload de Imagem -->
      <div class="form-group">
        <label class="form-label">Foto do Produto</label>
        <input type="file" accept="image/*" id="produtoImagem"
               onchange="previewImage(event)" class="form-control">
        <div class="image-preview" id="imagePreview">
          <div class="image-preview-placeholder">
            üì∑ Nenhuma imagem selecionada
          </div>
        </div>
        <small style="color: #666;">
          A imagem ser√° armazenada no Google Drive e vinculada ao produto.
        </small>
      </div>

      <div class="form-group">
        <label class="form-label">Descri√ß√£o</label>
        <textarea class="form-control" id="novoProdutoDescricao" rows="3"></textarea>
      </div>

      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button type="submit" class="btn btn-success" style="flex: 1;">
          ‚úÖ Salvar Produto
        </button>
        <button type="button" class="btn btn-secondary"
                onclick="closeModal('modalNovoProduto')" style="flex: 1;">
          ‚ùå Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
```

**Fun√ß√µes JavaScript para Upload:**
```javascript
function previewImage(event) {
  const file = event.target.files[0];
  const preview = document.getElementById('imagePreview');

  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
    };
    reader.readAsDataURL(file);
  }
}

function submitNovoProduto(event) {
  event.preventDefault();

  const fileInput = document.getElementById('produtoImagem');
  const file = fileInput.files[0];

  showLoading();

  // Se h√° imagem, fazer upload primeiro
  if (file) {
    uploadImagemProduto(file, function(imageUrl) {
      salvarProdutoComImagem(imageUrl);
    });
  } else {
    salvarProdutoComImagem(null);
  }
}

function uploadImagemProduto(file, callback) {
  const reader = new FileReader();
  reader.onload = function(e) {
    const base64 = e.target.result.split(',')[1];
    const fileName = file.name;
    const mimeType = file.type;

    google.script.run
      .withSuccessHandler(function(response) {
        if (response.success) {
          callback(response.imageUrl);
        } else {
          hideLoading();
          showError('Erro ao fazer upload da imagem: ' + response.error);
        }
      })
      .withFailureHandler(function(error) {
        hideLoading();
        showError('Erro no upload: ' + error.message);
      })
      .__uploadImagemDrive(base64, fileName, mimeType);
  };
  reader.readAsDataURL(file);
}

function salvarProdutoComImagem(imageUrl) {
  const produto = {
    codigo: document.getElementById('novoProdutoCodigo').value,
    nome: document.getElementById('novoProdutoNome').value,
    tipo: document.getElementById('novoProdutoTipo').value,
    categoria: document.getElementById('novoProdutoCategoria').value,
    unidade: document.getElementById('novoProdutoUnidade').value,
    preco: parseFloat(document.getElementById('novoProdutoPreco').value) || 0,
    descricao: document.getElementById('novoProdutoDescricao').value,
    imagemUrl: imageUrl || ''
  };

  google.script.run
    .withSuccessHandler(function(response) {
      hideLoading();
      if (response.success) {
        showSuccess('Produto salvo com sucesso!');
        closeModal('modalNovoProduto');
        loadProdutos();
      } else {
        showError('Erro ao salvar produto: ' + response.error);
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showError('Erro: ' + error.message);
    })
    .__createProduto(produto);
}
```

---

### **4. ABA "ESTOQUE" - APENAS ENTRADA**

**Mudan√ßa:** Remover funcionalidade de "Sa√≠da Manual"

**Motivo:** Sa√≠das agora s√£o feitas APENAS via aba "Pedidos" (dar baixa)

**Funcionalidades Mantidas:**
- ‚úÖ Visualizar estoque atual
- ‚úÖ Entrada de produtos (compras, reposi√ß√£o)
- ‚úÖ Ajuste de estoque (invent√°rio)
- ‚ùå ~~Sa√≠da manual~~ (REMOVIDO)

**Atualiza√ß√£o na Interface:**
```html
<section class="page-section" id="page-estoque">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">üìä Controle de Estoque</h2>
      <div>
        <button class="btn btn-primary" onclick="openModal('modalEntradaEstoque')">
          ‚¨ÜÔ∏è Entrada de Produtos
        </button>
        <button class="btn btn-outline" onclick="openModal('modalAjusteEstoque')">
          üîß Ajuste de Estoque
        </button>
      </div>
    </div>

    <!-- Removido: bot√£o "Sa√≠da de Produtos" -->

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Produto</th>
            <th>Tipo</th>
            <th>Qtd. Atual</th>
            <th>Qtd. M√≠nima</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="estoqueTableBody"></tbody>
      </table>
    </div>
  </div>
</section>
```

---

### **5. ABA "MOVIMENTA√á√ÉO" (antes "GERENCIAMENTO")**

**Corre√ß√£o de Bug:** Erro "Cannot read properties of null"

**Causa:** Fun√ß√£o `getAnaliseProdutos()` retornando `null`

**Solu√ß√£o:**
1. Verificar se fun√ß√£o existe no backend
2. Adicionar tratamento de erro robusto
3. Adicionar fallback com dados vazios

**C√≥digo Corrigido:**
```javascript
function loadMovimentacao() {
  showLoading();

  google.script.run
    .withSuccessHandler(function(response) {
      try {
        hideLoading();

        // Verificar se resposta √© v√°lida
        if (!response) {
          console.error('‚ùå Resposta vazia ao carregar movimenta√ß√£o');
          renderMovimentacaoEmpty();
          return;
        }

        if (response.success && response.analise) {
          renderMovimentacaoKPIs(response.analise);
          renderProdutosAlerta(response.analise.produtosEmAlerta || []);
        } else {
          console.error('Erro:', response.error);
          renderMovimentacaoEmpty();
        }
      } catch (error) {
        console.error('‚ùå Erro ao processar movimenta√ß√£o:', error);
        renderMovimentacaoEmpty();
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      console.error('‚ùå Erro de conex√£o:', error);
      showError('Erro ao carregar dados de movimenta√ß√£o');
      renderMovimentacaoEmpty();
    })
    .__getAnaliseProdutos(); // Verificar se existe no wrapper

  // Carregar hist√≥rico
  loadHistoricoMovimentacoes();
}

function renderMovimentacaoEmpty() {
  const container = document.getElementById('gerenciamentoKpiGrid');
  if (container) {
    container.innerHTML = `
      <div class="alert alert-info">
        ‚ÑπÔ∏è Nenhum dado dispon√≠vel no momento
      </div>
    `;
  }
}
```

---

### **6. ABA "RELAT√ìRIOS" - M√öLTIPLOS RELAT√ìRIOS**

**Objetivo:** Fornecer an√°lises profundas com insights acion√°veis

**Estrutura:**
```html
<section class="page-section" id="page-relatorios">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">üìà Relat√≥rios e Insights</h2>
    </div>

    <!-- Seletores de Relat√≥rio -->
    <div class="filter-grid" style="margin-bottom: 30px;">
      <div class="form-group">
        <label class="form-label">Tipo de Relat√≥rio</label>
        <select class="form-control" id="tipoRelatorio" onchange="loadRelatorio()">
          <option value="visao_geral">Vis√£o Geral</option>
          <option value="financeiro">An√°lise Financeira</option>
          <option value="logistico">An√°lise Log√≠stica</option>
          <option value="estoque">An√°lise de Estoque</option>
          <option value="produtos">An√°lise de Produtos</option>
          <option value="usuarios">An√°lise de Usu√°rios</option>
          <option value="tendencias">Tend√™ncias e Previs√µes</option>
          <option value="comparativo">Comparativo de Per√≠odos</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Per√≠odo</label>
        <select class="form-control" id="periodoRelatorio" onchange="loadRelatorio()">
          <option value="7">√öltimos 7 dias</option>
          <option value="30" selected>√öltimos 30 dias</option>
          <option value="90">√öltimos 90 dias</option>
          <option value="180">√öltimos 6 meses</option>
          <option value="365">√öltimo ano</option>
          <option value="custom">Personalizado</option>
        </select>
      </div>

      <div class="form-group">
        <button class="btn btn-primary" onclick="loadRelatorio()" style="width: 100%;">
          üîÑ Atualizar Relat√≥rio
        </button>
      </div>

      <div class="form-group">
        <button class="btn btn-success" onclick="exportarRelatorio()" style="width: 100%;">
          üì• Exportar para Excel
        </button>
      </div>
    </div>

    <!-- Container do Relat√≥rio -->
    <div id="relatorioContainer"></div>
  </div>
</section>
```

**8 Tipos de Relat√≥rios:**

1. **Vis√£o Geral**
   - Resumo consolidado de todos os KPIs
   - Principais alertas e recomenda√ß√µes
   - Gr√°ficos de tend√™ncias gerais

2. **An√°lise Financeira**
   - Gastos por tipo, setor, produto
   - Evolu√ß√£o mensal/trimestral
   - Compara√ß√£o com or√ßamento/metas
   - Top produtos mais caros
   - Oportunidades de economia

3. **An√°lise Log√≠stica**
   - Tempos m√©dios de cada fase
   - Taxa de aprova√ß√£o/cancelamento
   - Efici√™ncia de processamento
   - Gargalos identificados
   - Solicitantes mais ativos

4. **An√°lise de Estoque**
   - Giro de estoque por produto
   - Produtos com ruptura frequente
   - Produtos parados (sem movimenta√ß√£o)
   - Previs√£o de reposi√ß√£o
   - Custo de armazenagem

5. **An√°lise de Produtos**
   - Produtos mais solicitados
   - Produtos nunca solicitados
   - Valor m√©dio por produto
   - Correla√ß√£o entre produtos
   - Sugest√µes de mix

6. **An√°lise de Usu√°rios**
   - Solicita√ß√µes por usu√°rio
   - Gastos por departamento
   - Padr√µes de solicita√ß√£o
   - Usu√°rios mais ativos/inativos

7. **Tend√™ncias e Previs√µes**
   - Previs√£o de gastos pr√≥ximos 3 meses
   - Produtos que precisar√£o reposi√ß√£o
   - Tend√™ncias sazonais
   - Alertas preventivos

8. **Comparativo de Per√≠odos**
   - Compara√ß√£o m√™s a m√™s
   - Crescimento/redu√ß√£o de gastos
   - Identifica√ß√£o de anomalias
   - An√°lise de varia√ß√µes

---

### **7. ABA "CONFIGURA√á√ïES" - CORRE√á√ïES**

**Bug 1:** Erro "carregarUsuarios is not defined"

**Causa:** Fun√ß√£o n√£o existe ou n√£o est√° no escopo global

**Solu√ß√£o:**
```javascript
// Garantir que fun√ß√£o existe
function loadConfiguracoes() {
  if (currentUser.perfil !== 'Admin') {
    document.getElementById('configContent').innerHTML = `
      <div class="alert alert-warning">
        ‚ö†Ô∏è Acesso restrito a administradores
      </div>
    `;
    return;
  }

  // Renderizar interface de configura√ß√µes
  renderConfigInterface();

  // Carregar usu√°rios
  carregarUsuarios();

  // Carregar configura√ß√µes de sistema
  carregarConfigSistema();
}

function carregarUsuarios() {
  showLoading();
  google.script.run
    .withSuccessHandler(function(response) {
      hideLoading();
      if (response.success) {
        renderUsuariosTable(response.usuarios);
      } else {
        showError('Erro ao carregar usu√°rios: ' + response.error);
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showError('Erro: ' + error.message);
    })
    .__getUsuarios();
}

function renderConfigInterface() {
  const container = document.getElementById('configContent');
  container.innerHTML = `
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
      <!-- Painel Usu√°rios -->
      <div class="card">
        <h3>üë• Gerenciamento de Usu√°rios</h3>
        <button class="btn btn-primary" onclick="openModal('modalNovoUsuario')">
          ‚ûï Adicionar Usu√°rio
        </button>
        <div id="usuariosTable" style="margin-top: 20px;"></div>
      </div>

      <!-- Painel Configura√ß√µes de Sistema -->
      <div class="card">
        <h3>‚öôÔ∏è Configura√ß√µes de Sistema</h3>
        <form id="formConfigSistema">
          <div class="form-group">
            <label class="form-label">Cor Prim√°ria</label>
            <input type="color" class="form-control" id="configCorPrimaria"
                   value="#00A651">
          </div>

          <div class="form-group">
            <label class="form-label">Cor Secund√°ria</label>
            <input type="color" class="form-control" id="configCorSecundaria"
                   value="#2C3E50">
          </div>

          <button type="submit" class="btn btn-success">
            ‚úÖ Salvar Configura√ß√µes
          </button>
        </form>
      </div>
    </div>
  `;
}
```

**Bug 2:** Cores n√£o funcionam

**Causa:** Vari√°veis CSS n√£o est√£o sendo atualizadas dinamicamente

**Solu√ß√£o:**
```javascript
function aplicarCoresPersonalizadas(corPrimaria, corSecundaria) {
  // Atualizar vari√°veis CSS
  document.documentElement.style.setProperty('--primary', corPrimaria);
  document.documentElement.style.setProperty('--secondary', corSecundaria);

  // Salvar no localStorage para persistir
  localStorage.setItem('cor_primaria', corPrimaria);
  localStorage.setItem('cor_secundaria', corSecundaria);
}

// Ao carregar p√°gina, aplicar cores salvas
window.addEventListener('DOMContentLoaded', function() {
  const corPrimaria = localStorage.getItem('cor_primaria');
  const corSecundaria = localStorage.getItem('cor_secundaria');

  if (corPrimaria) {
    document.documentElement.style.setProperty('--primary', corPrimaria);
  }
  if (corSecundaria) {
    document.documentElement.style.setProperty('--secondary', corSecundaria);
  }
});
```

---

## üì¶ NOVOS ARQUIVOS BACKEND

### **1. 07.relatorios.js**

Fun√ß√µes para gerar todos os 8 tipos de relat√≥rios

**Fun√ß√µes principais:**
- `getRelatorioVisaoGeral(periodo)`
- `getRelatorioFinanceiro(periodo)`
- `getRelatorioLogistico(periodo)`
- `getRelatorioEstoque(periodo)`
- `getRelatorioProdutos(periodo)`
- `getRelatorioUsuarios(periodo)`
- `getRelatorioTendencias(periodo)`
- `getRelatorioComparativo(periodo1, periodo2)`

### **2. 08.upload_imagens.js**

Fun√ß√µes para upload e gest√£o de imagens no Google Drive

**Fun√ß√µes principais:**
- `uploadImagemDrive(base64, fileName, mimeType)` - Faz upload e retorna URL
- `criarPastaImagensProdutos()` - Cria pasta organizada no Drive
- `deletarImagemDrive(imageUrl)` - Remove imagem ao deletar produto
- `getImageUrl(fileId)` - Converte ID do Drive para URL p√∫blica

---

## üîÑ ARQUIVOS BACKEND ATUALIZADOS

### **1. 00.funcoes_wrapper.js**

Adicionar wrappers:
```javascript
function __uploadImagemDrive(base64, fileName, mimeType) {
  try {
    return serializarParaFrontend(uploadImagemDrive(base64, fileName, mimeType));
  } catch (e) {
    return { success: false, error: e.message };
  }
}

function __darBaixaPedido(pedidoId) {
  try {
    return serializarParaFrontend(darBaixaPedido(pedidoId));
  } catch (e) {
    return { success: false, error: e.message };
  }
}

function __getRelatorio(tipo, periodo) {
  try {
    return serializarParaFrontend(getRelatorio(tipo, periodo));
  } catch (e) {
    return { success: false, error: e.message };
  }
}

function __getAnaliseProdutos() {
  try {
    return serializarParaFrontend(getAnaliseProdutos());
  } catch (e) {
    return { success: false, error: e.message };
  }
}

function __getUsuarios() {
  try {
    return serializarParaFrontend(getUsuarios());
  } catch (e) {
    return { success: false, error: e.message };
  }
}
```

### **2. 02.pedidos.js**

Adicionar fun√ß√£o:
```javascript
function darBaixaPedido(pedidoId) {
  // 1. Buscar pedido
  // 2. Validar status (deve estar em "Aguardando Entrega")
  // 3. Para cada produto do pedido:
  //    - Dar sa√≠da no estoque
  //    - Registrar movimenta√ß√£o
  // 4. Atualizar status do pedido para "Finalizado"
  // 5. Registrar data de finaliza√ß√£o
}
```

---

## ‚úÖ CHECKLIST DE IMPLEMENTA√á√ÉO

### **Banco de Dados:**
- [ ] Adicionar coluna "Imagem URL" na aba Produtos
- [ ] Adicionar coluna "Pedido ID" na aba Movimenta√ß√µes (se n√£o existir)
- [ ] Criar aba "Relatorios_Config" (opcional)

### **Backend:**
- [ ] Criar arquivo `07.relatorios.js`
- [ ] Criar arquivo `08.upload_imagens.js`
- [ ] Atualizar `00.funcoes_wrapper.js` com novos wrappers
- [ ] Atualizar `02.pedidos.js` com fun√ß√£o `darBaixaPedido`

### **Frontend:**
- [ ] Criar `Index_v8.html` com todas as mudan√ßas
- [ ] Atualizar menu de navega√ß√£o
- [ ] Criar aba "Solicita√ß√£o"
- [ ] Atualizar aba "Pedidos" com baixa de produtos
- [ ] Atualizar aba "Produtos" com upload de fotos
- [ ] Atualizar aba "Estoque" (remover sa√≠da manual)
- [ ] Renomear e corrigir aba "Gerenciamento" ‚Üí "Movimenta√ß√£o"
- [ ] Criar aba "Relat√≥rios" completa
- [ ] Corrigir aba "Configura√ß√µes"

---

**Vers√£o:** 8.0
**Data:** 31 de outubro de 2025
**Arquiteto:** Claude Sonnet 4.5
