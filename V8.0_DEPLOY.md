# üöÄ DEPLOY VERS√ÉO 8.0 - GUIA COMPLETO PASSO A PASSO

## ‚ö†Ô∏è ANTES DE COME√áAR

### **BACKUP OBRIGAT√ìRIO**
1. Fa√ßa uma c√≥pia completa da planilha do Google Sheets
2. Exporte o projeto do Apps Script (Arquivo > Fazer download do projeto)
3. Guarde esses backups em local seguro

### **TEMPO ESTIMADO**
- Prepara√ß√£o: 15 min
- Backend: 25 min
- Frontend: 15 min
- Testes: 20 min
- **TOTAL: ~75 minutos**

---

## üìã FASE 1: PREPARA√á√ÉO DO BANCO DE DADOS (15 min)

### **Passo 1.1: Adicionar Coluna "Imagem URL" na Aba Produtos**

1. Abra a planilha do Google Sheets
2. V√° para a aba **"Produtos"**
3. Identifique a √∫ltima coluna com dados (ex: coluna L)
4. Clique na pr√≥xima coluna vazia (ex: coluna M)
5. Na c√©lula M1 (cabe√ßalho), digite: **`Imagem URL`**
6. **ANOTE O N√öMERO DESTA COLUNA:**
   - Se voc√™ colocou na coluna M, o √≠ndice √© **13**
   - Se voc√™ colocou na coluna N, o √≠ndice √© **14**
   - **VOC√ä VAI PRECISAR DESTE N√öMERO NO PASSO 2.3!**

‚úÖ **Checkpoint:** Coluna "Imagem URL" criada e √≠ndice anotado

---

### **Passo 1.2: Verificar/Adicionar Coluna "Pedido ID" na Aba Movimenta√ß√µes**

1. V√° para a aba **"Movimenta√ß√µes"**
2. Verifique se existe a coluna "Pedido ID" (deve ser a 9¬™ coluna)
3. **Se N√ÉO existir:**
   - Clique na coluna I (9¬™ coluna)
   - Na c√©lula I1, digite: **`Pedido ID`**

‚úÖ **Checkpoint:** Coluna "Pedido ID" existe na aba Movimenta√ß√µes

---

### **Passo 1.3: Verificar Perfis de Usu√°rios**

1. V√° para a aba **"Usu√°rios"**
2. Verifique se a coluna "Perfil" existe
3. Os valores devem ser:
   - `Admin` (com A mai√∫sculo)
   - `Gestor` (com G mai√∫sculo)
   - `Funcionario` (com F mai√∫sculo, SEM acento)
4. **CERTIFIQUE-SE** que existe pelo menos 1 usu√°rio com perfil `Admin`
5. Se necess√°rio, corrija os perfis

‚úÖ **Checkpoint:** Perfis de usu√°rios verificados e corretos

---

## üîß FASE 2: DEPLOY DO BACKEND (25 min)

### **Passo 2.1: Upload de Novos Arquivos**

1. Acesse https://script.google.com
2. Abra o projeto do sistema Neoformula

**Arquivo 1: 07.relatorios**
1. Clique em **+** ao lado de "Arquivos"
2. Selecione **Script**
3. Nome: `07.relatorios`
4. Abra o arquivo local `07.relatorios.js`
5. Copie TODO o conte√∫do (Ctrl+A, Ctrl+C)
6. Cole no Apps Script (Ctrl+V)
7. Clique em **Salvar** (Ctrl+S)

**Arquivo 2: 08.upload_imagens**
1. Clique em **+** ao lado de "Arquivos"
2. Selecione **Script**
3. Nome: `08.upload_imagens`
4. Abra o arquivo local `08.upload_imagens.js`
5. Copie TODO o conte√∫do
6. Cole no Apps Script
7. Clique em **Salvar**

‚úÖ **Checkpoint:** 2 novos arquivos criados

---

### **Passo 2.2: Atualizar 00.funcoes_wrapper**

1. No Apps Script, abra o arquivo **`00.funcoes_wrapper`**
2. **Role at√© o FINAL do arquivo** (√∫ltima linha)
3. Abra o arquivo local `00.funcoes_wrapper_v8_ADICOES.js`
4. Copie TODO o conte√∫do
5. Cole no Apps Script **ANTES da √∫ltima chave de fechamento** `}`
6. Clique em **Salvar**

‚úÖ **Checkpoint:** Arquivo `00.funcoes_wrapper` atualizado com 13 novos wrappers

---

### **Passo 2.3: Configurar √çndice da Coluna Imagem URL**

**IMPORTANTE:** Use o n√∫mero que voc√™ anotou no Passo 1.1!

1. No Apps Script, abra o arquivo **`08.upload_imagens`**
2. Localize a linha (~linha 155):
   ```javascript
   const colunaImagemUrl = 13; // VERIFICAR E AJUSTAR!
   ```
3. **ALTERE o n√∫mero 13 para o √≠ndice que voc√™ anotou**
4. Exemplo: Se sua coluna "Imagem URL" √© a coluna N, mude para:
   ```javascript
   const colunaImagemUrl = 14;
   ```
5. Clique em **Salvar**

‚úÖ **Checkpoint:** √çndice da coluna configurado corretamente

---

### **Passo 2.4: Atualizar 02.pedidos**

1. No Apps Script, abra o arquivo **`02.pedidos`**
2. **Role at√© o FINAL do arquivo**
3. Abra o arquivo local `02.pedidos_v8_ADICOES.js`
4. Copie TODO o conte√∫do
5. Cole no Apps Script **ANTES da √∫ltima chave de fechamento** `}`
6. Clique em **Salvar**

‚úÖ **Checkpoint:** Arquivo `02.pedidos` atualizado com 5 novas fun√ß√µes

---

### **Passo 2.5: Testar Backend**

1. No Apps Script, abra o arquivo **`08.upload_imagens`**
2. Na fun√ß√£o dropdown (topo), selecione: **`testeUploadImagem`**
3. Clique em **Executar** (‚ñ∂Ô∏è)
4. **Primeira execu√ß√£o:** Vai pedir autoriza√ß√£o
   - Clique em "Revisar permiss√µes"
   - Selecione sua conta
   - Clique em "Avan√ßado"
   - Clique em "Ir para [nome do projeto] (n√£o seguro)"
   - Clique em "Permitir"
5. Aguarde conclus√£o
6. V√° em **Execu√ß√µes** (menu lateral esquerdo)
7. Clique na execu√ß√£o mais recente
8. Verifique se aparece: **`‚úÖ Teste de upload passou!`**

‚úÖ **Checkpoint:** Teste de upload funcionando

---

## üé® FASE 3: DEPLOY DO FRONTEND (15 min)

**ATEN√á√ÉO:** O frontend completo (Index_v8.html) est√° muito grande para criar manualmente aqui.

### **Op√ß√µes:**

**OP√á√ÉO A: Aguardar arquivo Index_v8.html completo**
- Solicite o arquivo completo Index_v8.html
- Substitua o Index.html atual pelo novo

**OP√á√ÉO B: Fazer altera√ß√µes manuais (mais trabalhoso)**
- Seguir as instru√ß√µes do arquivo `V8.0_MUDANCAS_DETALHADAS.md`
- Fazer cada altera√ß√£o manualmente no Index.html

**Para OP√á√ÉO A:**

1. No Apps Script, abra o arquivo **`Index`** (HTML)
2. **SELECIONE TODO O CONTE√öDO** (Ctrl+A)
3. **DELETE TUDO** (Delete)
4. Abra o arquivo local `Index_v8.html` (quando dispon√≠vel)
5. Copie TODO o conte√∫do
6. Cole no Apps Script
7. Clique em **Salvar**

‚úÖ **Checkpoint:** Frontend atualizado para v8.0

---

## üöÄ FASE 4: CRIAR NOVA VERS√ÉO (10 min)

### **Passo 4.1: Implantar Nova Vers√£o**

1. Clique em **Implantar** (canto superior direito)
2. Selecione **Gerenciar implanta√ß√µes**
3. Clique no √≠cone de **edi√ß√£o** (l√°pis) da implanta√ß√£o "App da Web"
4. Clique em **Nova vers√£o**
5. Na descri√ß√£o, digite:
   ```
   v8.0 - Reestrutura√ß√£o completa: Nova aba Solicita√ß√£o + Upload de Imagens + 8 Relat√≥rios + Baixa de Pedidos
   ```
6. **Executar como:** Eu (seu email)
7. **Quem tem acesso:** Qualquer pessoa (ou sua organiza√ß√£o)
8. Clique em **Implantar**
9. Clique em **Atualizar** na confirma√ß√£o
10. **COPIE A URL** que aparece

‚úÖ **Checkpoint:** Vers√£o v8.0 implantada com sucesso

---

## üß™ FASE 5: TESTES COMPLETOS (20 min)

### **Teste 1: Dashboard (Admin/Gestor apenas)**

1. Abra a URL em **aba an√¥nima** (Ctrl+Shift+N)
2. Fa√ßa login com usu√°rio Admin ou Gestor
3. Verifique se a aba **Dashboard** aparece
4. Clique em **Dashboard**
5. Verifique se os KPIs carregam
6. **Fa√ßa login com usu√°rio Funcion√°rio**
7. Verifique se a aba **Dashboard N√ÉO aparece**

‚úÖ **Passou:** Dashboard vis√≠vel apenas para Admin/Gestor

---

### **Teste 2: Nova Aba Solicita√ß√£o (Todos)**

1. Fa√ßa login com qualquer perfil
2. Clique na aba **‚ûï Solicita√ß√£o**
3. Selecione um tipo (Papelaria ou Limpeza)
4. Digite um termo na busca de produtos
5. Verifique se produtos aparecem
6. Selecione um produto
7. Preencha observa√ß√µes
8. Clique em "Enviar Solicita√ß√£o"
9. Verifique se pedido √© criado com sucesso

‚úÖ **Passou:** Solicita√ß√£o funciona para todos os usu√°rios

---

### **Teste 3: Baixa de Produtos em Pedidos**

1. Fa√ßa login com Admin ou Gestor
2. V√° para aba **Pedidos**
3. Localize um pedido com status "Aguardando Entrega"
   - Se n√£o houver, crie um pedido de teste e mude o status manualmente na planilha
4. Clique no bot√£o **"Dar Baixa"**
5. Verifique se modal abre com lista de produtos
6. Clique em **"Confirmar Baixa"**
7. Aguarde processamento
8. Verifique:
   - Pedido mudou para status "Finalizado"
   - Estoque foi reduzido (v√° na aba Estoque)
   - Movimenta√ß√£o foi registrada (v√° na aba Movimenta√ß√£o)

‚úÖ **Passou:** Baixa de produtos funcionando

---

### **Teste 4: Upload de Imagem de Produto**

1. Fa√ßa login com Admin ou Gestor
2. V√° para aba **Produtos**
3. Clique em "Novo Produto"
4. Preencha os campos obrigat√≥rios
5. Clique em "Escolher arquivo" na se√ß√£o "Foto do Produto"
6. Selecione uma imagem do seu computador
7. Verifique se preview aparece
8. Clique em "Salvar Produto"
9. Aguarde (pode demorar alguns segundos para upload)
10. Verifique se produto foi salvo
11. Abra a planilha e verifique se URL foi gravada na coluna "Imagem URL"

‚úÖ **Passou:** Upload de imagem funcionando

---

### **Teste 5: Aba Movimenta√ß√£o (ex-Gerenciamento)**

1. Fa√ßa login com Admin ou Gestor
2. Clique na aba **üìã Movimenta√ß√£o**
3. Verifique se:
   - KPIs carregam SEM ERRO
   - Hist√≥rico de movimenta√ß√µes aparece
   - Filtros funcionam
4. **Console (F12) N√ÉO deve mostrar erro de "null properties"**

‚úÖ **Passou:** Movimenta√ß√£o carregando sem erros

---

### **Teste 6: Relat√≥rios**

1. Fa√ßa login com Admin ou Gestor
2. Clique na aba **üìà Relat√≥rios**
3. Selecione tipo: **Vis√£o Geral**
4. Clique em "Atualizar Relat√≥rio"
5. Verifique se relat√≥rio carrega
6. Teste outros tipos:
   - An√°lise Financeira
   - An√°lise Log√≠stica
   - An√°lise de Estoque
7. Verifique se todos carregam sem erro

‚úÖ **Passou:** Relat√≥rios funcionando

---

### **Teste 7: Configura√ß√µes**

1. Fa√ßa login com Admin
2. Clique na aba **‚öôÔ∏è Configura√ß√µes**
3. Verifique se interface carrega SEM ERRO
4. **Console N√ÉO deve mostrar "carregarUsuarios is not defined"**
5. Teste alterar cor prim√°ria
6. Clique em "Salvar Configura√ß√µes"
7. Recarregue a p√°gina
8. Verifique se cores foram aplicadas

‚úÖ **Passou:** Configura√ß√µes funcionando

---

### **Teste 8: Permiss√µes por Perfil**

**Teste com Funcion√°rio:**
- ‚úÖ Pode acessar: Solicita√ß√£o, Pedidos (view)
- ‚ùå N√ÉO pode acessar: Dashboard, Produtos, Estoque, Movimenta√ß√£o, Relat√≥rios, Configura√ß√µes

**Teste com Gestor:**
- ‚úÖ Pode acessar: Dashboard, Solicita√ß√£o, Pedidos, Produtos, Estoque, Movimenta√ß√£o, Relat√≥rios
- ‚ùå N√ÉO pode acessar: Configura√ß√µes

**Teste com Admin:**
- ‚úÖ Pode acessar: TUDO

‚úÖ **Passou:** Permiss√µes corretas por perfil

---

## üêõ TROUBLESHOOTING

### **Problema 1: "Erro ao fazer upload de imagem"**

**Causa:** Permiss√µes do Google Drive

**Solu√ß√£o:**
1. V√° em Apps Script > Execu√ß√µes
2. Verifique o erro detalhado
3. Pode ser necess√°rio autorizar novamente o acesso ao Drive
4. Execute `testeUploadImagem` novamente

---

### **Problema 2: "Cannot read properties of null" em Movimenta√ß√£o**

**Causa:** Fun√ß√£o `getAnaliseProdutos` n√£o existe ou retorna null

**Solu√ß√£o:**
1. Verifique se arquivo `00.funcoes_wrapper` tem a fun√ß√£o `__getAnaliseProdutos`
2. Verifique se h√° tratamento de null na fun√ß√£o
3. Se persistir, verifique se dados existem na planilha

---

### **Problema 3: Relat√≥rios n√£o carregam**

**Causa:** Arquivo `07.relatorios.js` n√£o foi adicionado ou tem erro

**Solu√ß√£o:**
1. Verifique se arquivo `07.relatorios` existe no Apps Script
2. V√° em Execu√ß√µes e verifique erros
3. Teste manualmente a fun√ß√£o `getRelatorioVisaoGeral(30)`

---

### **Problema 4: Baixa de pedido falha**

**Causa:** Produtos n√£o encontrados no estoque ou estoque insuficiente

**Solu√ß√£o:**
1. Verifique se produtos do pedido existem na aba Estoque
2. Verifique se h√° quantidade suficiente
3. Verifique logs do Apps Script para erro detalhado

---

### **Problema 5: Imagem n√£o aparece ap√≥s upload**

**Causa:** URL n√£o foi salva na planilha ou √≠ndice de coluna incorreto

**Solu√ß√£o:**
1. Verifique se URL foi gravada na coluna "Imagem URL" da planilha
2. Verifique o √≠ndice configurado em `08.upload_imagens.js` (linha ~155)
3. Ajuste o √≠ndice conforme necess√°rio

---

## ‚úÖ CHECKLIST FINAL

Antes de considerar o deploy conclu√≠do:

### **Banco de Dados:**
- [ ] Coluna "Imagem URL" adicionada em Produtos
- [ ] Coluna "Pedido ID" existe em Movimenta√ß√µes
- [ ] Perfis de usu√°rios corretos
- [ ] Pelo menos 1 Admin cadastrado

### **Backend:**
- [ ] Arquivo `07.relatorios` criado
- [ ] Arquivo `08.upload_imagens` criado
- [ ] Arquivo `00.funcoes_wrapper` atualizado (13 novos wrappers)
- [ ] Arquivo `02.pedidos` atualizado (5 novas fun√ß√µes)
- [ ] √çndice da coluna "Imagem URL" configurado corretamente
- [ ] Teste de upload passou

### **Frontend:**
- [ ] Index_v8.html implantado
- [ ] Nova vers√£o criada

### **Testes:**
- [ ] Dashboard carrega (Admin/Gestor)
- [ ] Solicita√ß√£o funciona (Todos)
- [ ] Baixa de pedidos funciona
- [ ] Upload de imagem funciona
- [ ] Movimenta√ß√£o sem erros
- [ ] Relat√≥rios carregam
- [ ] Configura√ß√µes sem erros
- [ ] Permiss√µes corretas por perfil

---

## üéâ PARAB√âNS!

Se todos os testes passaram, voc√™ agora tem o **Sistema Neoformula v8.0** rodando com:

‚úÖ Nova aba de Solicita√ß√£o simplificada
‚úÖ Upload de imagens de produtos
‚úÖ 8 tipos de relat√≥rios profissionais
‚úÖ Baixa autom√°tica de produtos
‚úÖ Rastreabilidade completa
‚úÖ Permiss√µes refinadas por perfil

---

## üìû SUPORTE P√ìS-DEPLOY

**Primeiras 48h:** Monitore os logs do Apps Script (Execu√ß√µes)

**Documenta√ß√£o:**
- `V8.0_RESUMO_EXECUTIVO.md` - Vis√£o geral
- `V8.0_MUDANCAS_DETALHADAS.md` - Detalhes t√©cnicos
- `V8.0_INSTRUCOES_BANCO_DADOS.md` - Altera√ß√µes na planilha

**Em caso de problemas cr√≠ticos:**
1. Restaure o backup da planilha
2. Reverta para vers√£o anterior no Apps Script (Implantar > Gerenciar implanta√ß√µes > Selecionar vers√£o anterior)

---

**Vers√£o:** 8.0
**Data:** 31 de outubro de 2025
**Status:** ‚úÖ Pronto para produ√ß√£o
**Tempo de deploy:** ~75 minutos
**Revers√≠vel:** Sim (via backup)
